# PoC for CVE-2024-9936 / Bug 1912471

This repository contains a Proof of Concept (PoC) HTML page to test **CVE-2024-9936 / Bug 1912471** in Firefox. This vulnerability is related to the repeated deserialization of structured clone buffers with transferable objects, which can lead to unexpected behavior, such as crashes.

## üìã Description

The PoC attempts to:
1. Create a transferable object (`ArrayBuffer`).
2. Serialize this object with the `structuredClone` method, using the `transfer` option, which detaches the original buffer.
3. Deserialize the buffer once (expected to succeed).
4. Attempt to deserialize the same serialized buffer a second time, which **should** throw an error.
5. Finally, it logs whether the vulnerability is present or absent based on the observed behavior.

This PoC is intended to test for the presence of the vulnerability in different versions of Firefox, especially prior to version **131.0.3**, where the vulnerability is believed to be fixed.

## üö® Disclaimer

**Warning:** This PoC is intended for educational purposes only. It should be used in a controlled and safe environment. Unauthorized testing or exploitation of software without explicit permission is illegal and unethical. **Do not use this PoC on systems that you do not own or have explicit permission to test**.

## üìÇ File List

- `cve-2024-9936-poc.html`: The HTML file containing the PoC.

## üìã Usage Instructions

### Prerequisites

- **Firefox Browser**: It is recommended to use Firefox to observe the behavior. This PoC is aimed at detecting the vulnerability in Firefox versions below **131.0.3**.
- **Basic HTML Knowledge**: Some familiarity with running HTML files in a browser.

### Steps to Run

1. **Download and Save the PoC File**

   Save the provided HTML code as a file named `cve-2024-9936-poc.html` on your computer.

2. **Open the File in Firefox**

   - Launch **Firefox**.
   - Open the HTML file in Firefox:
     - You can use the `File > Open File` menu or drag and drop the HTML file into a Firefox window.

3. **Open the Developer Console**

   - Press `F12` or `Ctrl+Shift+I` to open **Developer Tools**.
   - Go to the **"Console"** tab to monitor any console logs that will help you understand the browser's behavior.

4. **Run the PoC**

   - Click the **"Run PoC"** button on the page.
   - Observe the step-by-step logs displayed on the web page and in the **Console** tab of the Developer Tools.

5. **Interpret the Results**

   The output of the PoC will provide a conclusion on whether the vulnerability is present in the current browser version:

   - **If the vulnerability is present**: The script will indicate that a vulnerability is present.
   - **If the vulnerability is absent**: The script will indicate that no vulnerability is present, and Firefox handled the test as expected.

## üìã Example Output

Below is an example of the output that you might see on the web page after running the PoC:

### Vulnerability **Absent** (Fixed)

```
Starting PoC...
Created ArrayBuffer and initialized with data.
ArrayBuffer serialized with transferables.
ArrayBuffer successfully detached after serialization.
First deserialization succeeded.
Deserialized ArrayBuffer contains valid data.
Expected error on second deserialization: cannot transfer twice
Browser correctly handled second deserialization of transferables.
**Vulnerability CVE-2024-9936 / Bug 1912471 is ABSENT in the current browser version.**
```

### Vulnerability **Present** (Not Fixed)

```
Starting PoC...
Created ArrayBuffer and initialized with data.
ArrayBuffer serialized with transferables.
Error: ArrayBuffer should be detached and inaccessible.
PoC completed with error: TypeError: Cannot read property 'byteLength' of undefined
**Vulnerability CVE-2024-9936 / Bug 1912471 is PRESENT in the current browser version.**
```

## üí° How It Works

1. **Create Transferable (`ArrayBuffer`)**: The PoC begins by creating an `ArrayBuffer` that is transferred using the `structuredClone` function.
2. **Serialize and Deserialize**:
   - First, the `ArrayBuffer` is serialized, detaching it from its original reference.
   - The first deserialization is expected to succeed.
3. **Second Attempt to Deserialize**: The second attempt to deserialize the buffer is expected to fail, as the object was transferred during the first deserialization. If this does not happen, it indicates a vulnerability.
4. **Logs Conclusion**: Based on whether an error is thrown during the second deserialization, the PoC concludes if the vulnerability is present or not.

## ‚úÖ Requirements

- **Browser**: **Firefox** (preferably versions **below 131.0.3** for testing the vulnerability, or above to verify that the issue is fixed).
- **HTML File**: You need to save the PoC as an HTML file and run it locally.

## üîç Important Notes

- **Controlled Environment**: Perform this test in a safe and controlled environment (e.g., a virtual machine) to avoid any potential system issues.
- **Vulnerability Testing**: This PoC is intended for **testing purposes only**. Do not exploit any vulnerabilities for malicious purposes.

## üõ†Ô∏è Reporting Issues

If you observe the vulnerability is present in a version where it should be fixed, please report it immediately to the **Mozilla Security Team** via [Mozilla's official channels](https://www.mozilla.org/en-US/security/advisories/).

## üìú License

This PoC is open for educational and security research purposes. Please use it ethically and responsibly.
